(this.webpackJsonp=this.webpackJsonp||[]).push([["sms77-shopware6"],{"1EKD":function(e,t){e.exports='{% block sms77_api_index %}\n    <sw-page>\n        <template slot="smart-bar-actions">\n            <sw-button\n                    :routerLink="{ name: \'sms77.api.compose\' }"\n                    variant="primary"\n            >\n                {{ $tc(\'sms77-api.compose.header\') }}\n            </sw-button>\n        </template>\n\n        <template slot="content">\n            <h2>{{ $tc(\'sms77-api.messages.header\') }}</h2>\n\n            <sw-entity-listing\n                    :columns="columns"\n                    detailRoute="sw.mail.template.detail_head_foot"\n                    :isLoading="isLoading"\n                    :items="messages"\n                    :repository="repository"\n                    :showSelection="true"\n                    v-if="messages"\n            >\n            </sw-entity-listing>\n        </template>\n    </sw-page>\n{% endblock %}\n'},R4f8:function(e,t,n){e.exports=function e(t,n,s){function i(r,a){if(!n[r]){if(!t[r]){if(o)return o(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[r]={exports:{}};t[r][0].call(l.exports,(function(e){return i(t[r][1][e]||e)}),l,l.exports,e,t,n,s)}return n[r].exports}for(var o=!1,r=0;r<s.length;r++)i(s[r]);return i}({1:[function(e,t,n){t.exports=e("../src/Sms77Client").default},{"../src/Sms77Client":3}],2:[function(e,t,n){"use strict";var s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(i,o){function r(e){try{c(s.next(e))}catch(e){o(e)}}function a(e){try{c(s.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((s=s.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,s,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,s&&(i=2&o[0]?s.return:o[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,o[1])).done)return i;switch(s=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,s=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!((i=(i=r.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=t.call(e,r)}catch(e){o=[6,e],s=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};n.__esModule=!0;var r=e("./constants/ERROR_CODES"),a=function(){function e(e,t){this.apiKey=e,this.sendWith=t}return e.prototype.post=function(t,n){return i(this,void 0,void 0,(function(){var i,a,c,l,u,p;return o(this,(function(o){switch(o.label){case 0:return i=s(s({},n),{p:this.apiKey,sendWith:this.sendWith}),a=function(e){return"boolean"==typeof e?e?1:0:e},c=Object.entries(i).map((function(e){var t=e[0],n=e[1];return encodeURIComponent(t)+"="+encodeURIComponent(a(n))})).join("&"),l={headers:{"Content-Type":"multipart/form-data"},method:"POST"},[4,fetch(e.BASE_URL+"/"+t+"?"+c,l)];case 1:return[4,o.sent().text()];case 2:if(u=o.sent(),p=Number.parseInt(u),r.ERROR_CODES.has(p))throw new Error(p+": "+r.ERROR_CODES.get(p));try{return[2,JSON.parse(u)]}catch(e){}return[2,u]}}))}))},e.BASE_URL="https://gateway.sms77.io/api",e}();n.default=a},{"./constants/ERROR_CODES":4}],3:[function(e,t,n){"use strict";var s,i=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||o(t,e,n)},a=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(i,o){function r(e){try{c(s.next(e))}catch(e){o(e)}}function a(e){try{c(s.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((s=s.apply(e,t||[])).next())}))},c=this&&this.__generator||function(e,t){var n,s,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,s&&(i=2&o[0]?s.return:o[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,o[1])).done)return i;switch(s=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,s=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!((i=(i=r.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=t.call(e,r)}catch(e){o=[6,e],s=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};n.__esModule=!0,r(e("./types"),n);var u=e("./constants/SUCCESS_CODES"),p=l(e("./BaseClient")),d=function(e){return e.split("\n")},f=function(e){function t(t,n){void 0===n&&(n="js");var s=e.call(this,t,n)||this;return s.apiKey=t,s.sendWith=n,s}return i(t,e),t.prototype.balance=function(){return a(this,void 0,void 0,(function(){var e,t;return c(this,(function(n){switch(n.label){case 0:return t=(e=Number).parseFloat,[4,this.post("balance")];case 1:return[2,t.apply(e,[n.sent()])]}}))}))},t.prototype.contacts=function(e){return a(this,void 0,void 0,(function(){var t;return c(this,(function(n){switch(n.label){case 0:return[4,this.post("contacts",e)];case 1:if("string"==typeof(t=n.sent()))return[2,t];if(Array.isArray(t))return[2,t];if(u.SUCCESS_CODES.has(Number.parseInt(t.return))){if(t.id)return[2,Number.parseInt(t.id)];if(e.id)return[2,e.id]}throw new Error(t)}}))}))},t.prototype.lookup=function(e){return a(this,void 0,void 0,(function(){var t,n;return c(this,(function(s){switch(s.label){case 0:return[4,this.post("lookup",e)];case 1:if(t=s.sent(),n=function(e){return 100===Number.parseInt(e)},"string"==typeof t){if(!n(t))throw new Error(t)}else if(t.code&&!n(t.code))throw new Error(t);return[2,t]}}))}))},t.prototype.pricing=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.post("pricing",e)];case 1:return[2,t.sent()]}}))}))},t.prototype.sms=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.post("sms",e)];case 1:return[2,t.sent()]}}))}))},t.prototype.status=function(e){return a(this,void 0,void 0,(function(){var t,n,s,i;return c(this,(function(o){switch(o.label){case 0:return[4,this.post("status",e)];case 1:return t=o.sent(),n=d(t),s=n[0],i=n[1],[2,{report:s,timestamp:i}]}}))}))},t.prototype.validateForVoice=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.post("validate_for_voice",e)];case 1:return[2,t.sent()]}}))}))},t.prototype.voice=function(e){return a(this,void 0,void 0,(function(){var t,n,s,i,o;return c(this,(function(r){switch(r.label){case 0:return[4,this.post("voice",e)];case 1:return t=r.sent(),n=d(t),s=n[0],i=n[1],o=n[2],[2,{code:Number.parseInt(s),id:Number.parseInt(i),cost:Number.parseFloat(o)}]}}))}))},t}(p.default);n.default=f},{"./BaseClient":2,"./constants/SUCCESS_CODES":5,"./types":6}],4:[function(e,t,n){"use strict";n.__esModule=!0,n.ERROR_CODES=void 0,n.ERROR_CODES=new Map([[201,"Country code invalid."],[202,"Recipient number invalid."],[300,"Authentication missing."],[301,"Parameter to missing."],[304,"Parameter type missing."],[305,"Parameter text missing."],[306,"Sender invalid."],[307,"Parameter url missing."],[400,"Invalid type."],[401,"Parameter text too long."],[402,"Reload lock."],[500,"Not enough credits."],[600,"Carrier failed."],[700,"Unknown error."],[801,"Logo file missing."],[802,"Logo file not existent."],[803,"Ring tone missing."],[900,"Wrong API key!"],[901,"Wrong message ID."],[902,"API deactivated."],[903,"IP not allowed."]])},{}],5:[function(e,t,n){"use strict";n.__esModule=!0,n.SUCCESS_CODES=void 0,n.SUCCESS_CODES=new Map([[151,"Contacts updated/created/deleted with CSV response."],[152,"Contacts updated/created/deleted with JSON response."]])},{}],6:[function(e,t,n){"use strict";n.__esModule=!0},{}]},{},[1])(1)},WNTy:function(e,t,n){"use strict";n.r(t);var s=n("iMF+"),i=n.n(s),o=n("R4f8"),r=n.n(o);const a=Shopware.Context.api,c={inject:["repositoryFactory"],mounted(){document.querySelector(".sw-desktop__content").style.overflow="scroll"},data:()=>({repository:null,sms77Client:null,systemConfig:null}),created(){this.repository=this.repositoryFactory.create("sms77_message")},metaInfo(){return{title:this.$createTitle()}},methods:{getClient:e=>new r.a(e,"shopware6"),addSignature(e){return this.systemConfig.signature&&this.systemConfig.signaturePosition&&(e="append"===this.systemConfig.signaturePosition?`${this.systemConfig.signature}${e}`:`${e}${this.systemConfig.signature}`),e},async getSystemConfig(){const e=await Shopware.Service("systemConfigApiService").getValues("Sms77Shopware6.config");for(const[t,n]of Object.entries(e))""!==n&&void 0!==n&&(e[t.split(".").pop()]=n),delete e[t];return(e.apiKey||"").length&&(this.sms77Client=this.getClient(e.apiKey)),e},async sendSms(e){const t=(e,t)=>this.$options.optionalFields.booleans.includes(e)?"on"===t?1:0:t,n=(e=>Object.assign(...[...new FormData(e).entries()].filter(([,e])=>""!==e).map(([e,n])=>({[e]:t(e,n)}))))(e),s=await this.sms77Client.sms(n),i=Number.isInteger(s)?s:n.json?s.success:JSON.parse(s).success;return{type:"sms",config:n,response:n.json?s:{success:i}}},createEntity(e){const t=this.repository.create(a);for(const[n,s]of Object.entries(e))t[n]=s;return t},findAll(){return this.repository.search((new Shopware.Data.Criteria).addSorting(Shopware.Data.Criteria.sort("createdAt","DESC")),a).then(e=>e)},async saveEntity(e){const t=await this.repository.save(e,a);if(204!==t.status)throw new Error(t);return t},setMessages(){return this.findAll().then(e=>(this.messages=e,this.messages)).catch(e=>console.error({fromRepo:e}))}}},l={text:null,to:null},u={delay:null,foreign_id:null,from:null,label:null,udh:null},p={debug:!1,details:!1,flash:!1,json:!1,no_reload:!1,performance_tracking:!1,return_msg_id:!1,unicode:!1,utf8:!1},d={ttl:null},f={async created(){this.systemConfig=await this.getSystemConfig(),this.configuration.from=this.systemConfig.from||"",this.configuration.text=this.addSignature("")},computed:{isDisabled(){return!((this.configuration.to||"").length&&(this.configuration.text||"").length)}},optionalFields:{booleans:Object.keys(p),strings:Object.keys(u),numbers:Object.keys(d)},data:()=>({configuration:{...l,...u,...p,...d},info:null,isLoading:!1}),methods:{commonSettingAttrs(e,t=!0){const n={label:this.translateSetting(e,"label"),name:e};return t&&(n.placeholder=this.translateSettingDesc(e)),n},filterByType(e){return Object.keys(this.configuration).filter(t=>typeof this.configuration[t]===e)},translateSetting(e,t){return this.$tc(`sms77-api.compose.${e}.${t}`)},translateSettingTooltip(e){return{message:this.translateSettingDesc(e)}},translateSettingDesc(e){return this.translateSetting(e,"desc")},async handleSubmit(e){this.isLoading=!0,await this.saveEntity(this.createEntity(await this.sendSms(e.target))),this.isLoading=!1,this.$router.push({name:"sms77.api.index"})}},mixins:[c],template:i.a};Shopware.Component.register("sms77-api-compose",f);var m=n("1EKD"),h=n.n(m);const g={mixins:[Shopware.Mixin.getByName("listing"),c],created(){this.setMessages().then().catch(e=>console.error({fromRepo:e}))},data:()=>({columns:[{property:"type",dataIndex:"type",label:"sms77-api.compose.type",allowResize:!0,primary:!0},{property:"config",dataIndex:"config",label:"sms77-api.compose.config",allowResize:!0,sortable:!1},{property:"response",dataIndex:"response",label:"sms77-api.compose.response",allowResize:!0},{property:"created_at",dataIndex:"created_at",label:"sms77-api.compose.created",allowResize:!0},{property:"updated_at",dataIndex:"updated_at",label:"sms77-api.compose.updated",allowResize:!0}],isLoading:!1,messages:null,repository:null}),template:h.a};Shopware.Component.register("sms77-api-index",g);var y={"en-GB":n("pnuT")};Shopware.Module.register("sms77-api",{color:"#ff3d58",description:"Send SMS via the sms77io SMS gateway.",icon:"default-shopping-paper-bag-product",name:"sms77-api",navigation:[{color:"#ff3d58",icon:"default-shopping-paper-bag-product",label:"sms77-api.navigation",parent:"sw-marketing",path:"sms77.api.index"}],routes:{index:{component:"sms77-api-index",path:"index"},compose:{component:"sms77-api-compose",path:"compose"}},snippets:y,targetVersion:"1.0.0",title:"sms77-api.navigation",type:"plugin",version:"1.0.0"})},"iMF+":function(e,t){e.exports='{% block sms77_api_compose %}\n    <sw-page>\n        <template slot="smart-bar-header">\n            <h2>{{ $tc(\'sms77-api.compose.header\') }}</h2>\n        </template>\n\n        <template slot="smart-bar-actions">\n            <sw-button\n                    :disabled="isDisabled"\n                    form="sms77_compose"\n                    :isLoading="isLoading"\n                    variant="primary"\n            >\n                {{ $tc(\'sms77-api.compose.submit\') }}\n            </sw-button>\n        </template>\n\n        <template slot="content">\n            <sw-alert v-if=\'info\' variant="info" appearance="default"\n                      :showIcon="true" :closable="false">\n                {{ info }}\n            </sw-alert>\n\n            <form method="post" style=\'display: flex;\' id=\'sms77_compose\'\n                  @submit.prevent="handleSubmit">\n                <div style=\'width: 50%; padding-right: 6px;\'>\n                    <sw-textarea-field\n                            v-bind=\'commonSettingAttrs("text")\'\n                            required\n                            validation="required"\n                            type="textarea"\n                            v-model="configuration.text"\n                            v-tooltip="translateSettingTooltip(\'text\')"\n                    ></sw-textarea-field>\n\n                    <sw-text-field\n                            v-bind=\'commonSettingAttrs("to")\'\n                            required\n                            validation="required"\n                            v-model=\'configuration.to\'\n                            v-tooltip="translateSettingTooltip(\'to\')"\n                    >\n                    </sw-text-field>\n                </div>\n\n                <div style=\'width: 50%; padding-left: 6px;\'>\n                    <sw-number-field\n                            :key="name"\n                            :min="0"\n                            numberType="int"\n                            v-bind=\'commonSettingAttrs(name, false)\'\n                            v-for="name in $options.optionalFields.numbers"\n                            v-model=\'configuration[name]\'\n                            v-tooltip="translateSettingTooltip(name)"\n                    >\n                    </sw-number-field>\n\n                    <sw-text-field\n                            :key="name"\n                            v-bind=\'commonSettingAttrs(name)\'\n                            v-for="name in $options.optionalFields.strings"\n                            v-model.trim="configuration[name]"\n                            v-tooltip="translateSettingTooltip(name)"\n                    ></sw-text-field>\n\n                    <sw-switch-field\n                            :key="name"\n                            v-bind=\'commonSettingAttrs(name)\'\n                            v-for="name in $options.optionalFields.booleans"\n                            v-model="configuration[name]"\n                            v-tooltip="translateSettingTooltip(name)"\n                    ></sw-switch-field>\n                </div>\n            </form>\n        </template>\n    </sw-page>\n{% endblock %}\n'},pnuT:function(e){e.exports=JSON.parse('{"sms77-api":{"navigation":"Sms77.io API","compose":{"header":"Compose SMS","text":{"label":"Text","desc":"The actual message content."},"from":{"label":"From","desc":"Sender identifier"},"debug":{"label":"Debug","desc":"Disable message dispatching?"},"to":{"label":"To","desc":"Defines the recipient(s)."},"performance_tracking":{"label":"Performance Tracking","desc":"Enable performance tracking for found URLs?"},"json":{"label":"JSON","desc":"Return a detailed JSON response?"},"return_msg_id":{"label":"Return MSG ID","desc":"Append the message ID to the status response? Has no effect if \'JSON\' is set to true."},"details":{"label":"Details","desc":"Return a detailed response? Has no effect if \'JSON\' is set to true."},"utf8":{"label":"UTF8","desc":"Ignore server detection and force UTF-8 character set?"},"flash":{"label":"Flash","desc":"Dispatch as flash message(s)?"},"unicode":{"label":"Unicode","desc":"Ignore server detection and force unicode transmission for Cyrillic, Arabic etc characters? The SMS length gets reduced to 70 characters."},"no_reload":{"label":"No Reload","desc":"Switch off reload lock?"},"foreign_id":{"label":"Foreign ID","desc":"Custom ID included in DLR callbacks etc. Max. 64 chars; allowed characters: a-z, A-Z, 0-9, .-_@"},"label":{"label":"Label","desc":"Add a custom message label."},"ttl":{"label":"TTL","desc":"Set a custom time to live."},"type":"Type","config":"Config","response":"Response","created":"Created","updated":"Updated","udh":{"label":"UDH","desc":"Set a custom user data header."},"delay":{"label":"Delay","desc":"Date/Timestamp for delayed dispatch. Accepts an UNIX timestamp or a date of format yyyy-mm-dd hh:ii eg. 1141511104 or 2016-03-04 23:25:04."},"submit":"Send Message"},"messages":{"header":"Message History"}}}')}},[["WNTy","runtime"]]]);